<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colorado Holiday Markets 2025</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #d43e1f;
        }
        
        h1 {
            color: #d43e1f;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.2em;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .map-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            min-height: 500px;
        }
        
        #map {
            width: 100%;
            height: 500px;
            background: #e9ecef;
            border-radius: 8px;
        }
        
        .controls {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        .controls h3 {
            color: #d43e1f;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .filter-group {
            margin-bottom: 20px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #d43e1f;
        }
        
        button {
            width: 100%;
            padding: 12px;
            background: #d43e1f;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #b3341a;
        }
        
        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #d43e1f;
        }
        
        th {
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tbody tr {
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.3s;
            cursor: pointer;
        }
        
        tbody tr:hover {
            background: #f8f8f8;
        }
        
        tbody tr.selected {
            background: #ffe6e1;
        }
        
        td {
            padding: 15px;
        }
        
        .details-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 25px;
            display: none;
        }
        
        .details-container.active {
            display: block;
        }
        
        .details-container h3 {
            color: #d43e1f;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .detail-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            font-weight: 600;
            color: #555;
            display: inline-block;
            width: 100px;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            pointer-events: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            font-size: 14px;
            max-width: 300px;
            z-index: 1000;
        }
        
        a {
            color: #d43e1f;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #d43e1f;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ„ Colorado Holiday Markets 2025</h1>
            <p class="subtitle">Discover festive markets across Colorado this holiday season</p>
        </header>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="total-markets">5</div>
                <div class="stat-label">Total Markets</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="free-markets">5</div>
                <div class="stat-label">Free Entry</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="denver-markets">3</div>
                <div class="stat-label">In Denver Area</div>
            </div>
        </div>

        <div class="dashboard">
            <div class="map-container">
                <div id="map"></div>
            </div>
            
            <div class="controls">
                <h3>Filter Markets</h3>
                
                <div class="filter-group">
                    <label for="date-filter">Date Range</label>
                    <select id="date-filter">
                        <option value="all">All Dates</option>
                        <option value="nov">November Markets</option>
                        <option value="dec">December Markets</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="cost-filter">Cost</label>
                    <select id="cost-filter">
                        <option value="all">All Markets</option>
                        <option value="free">Free Entry Only</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="search">Search Markets</label>
                    <input type="text" id="search" placeholder="Type market name or location...">
                </div>
                
                <div class="filter-group">
                    <button id="reset-filters">Reset All Filters</button>
                </div>
                
                <div class="filter-group">
                    <h4>Selected Market</h4>
                    <select id="market-selector">
                        <option value="">Click a point or table row</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="table-container">
            <table id="market-table">
                <thead>
                    <tr>
                        <th>Market Name</th>
                        <th>Dates</th>
                        <th>Location</th>
                        <th>Cost</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

        <div id="market-details" class="details-container">
            <!-- Market details will be populated when a market is selected -->
        </div>
    </div>

    <script>
        // Market data - first 5 entries
        const marketData = [
            {
                "Name": "MCA Holiday Makers Market",
                "Latitude": 39.76213369,
                "lon": -105.0202682,
                "Icon": "snowflake",
                "Color": "#d43e1f",
                "Date": "Dec. 13-14",
                "Zip code": "80211",
                "Address": "MCA Denver at the Holiday, 2644 W 32nd Ave., Denver, CO 80211",
                "Cost": "Free",
                "Description": "Seasonal cocktails, gift wrapping, and handmade goods from local makers.",
                "Website": "https://mcadenver.org/events/holiday-makers-market-2025"
            },
            {
                "Name": "Mistletoe Market",
                "Latitude": 39.75338279,
                "lon": -104.9968463,
                "Icon": "snowflake",
                "Color": "#d43e1f",
                "Date": "Dec. 13-14 and 20-21",
                "Zip code": "80202",
                "Address": "1800 Wazee St, Denver, CO 80202",
                "Cost": "Free",
                "Description": "Pop-up shops from more than 40 local vendors, cookie decorating and wreath building stations, and live music.",
                "Website": "https://dairyblock.com/events/mistletoe-market-5-2/"
            },
            {
                "Name": "Cherry Creek Holiday Market",
                "Latitude": 39.7187592,
                "lon": -104.9537025,
                "Icon": "snowflake",
                "Color": "#d43e1f",
                "Date": "Nov. 20-Dec. 24",
                "Zip code": "80206",
                "Address": "105 Fillmore St, Denver, CO 80206",
                "Cost": "Free",
                "Description": "For a full month The Cherry Creek Holiday Market sets up shop at Fillmore Plaza with semi-permanent booths open daily to the public, a concert series and the popular Mistletoe Lounge serving festive cocktails.",
                "Website": "https://www.cherrycreekholidaymarket.com/"
            },
            {
                "Name": "Denver Christkindlmarket",
                "Latitude": 39.74578476,
                "lon": -105.004527,
                "Icon": "snowflake",
                "Color": "#d43e1f",
                "Date": "Nov. 21-Dec. 23",
                "Zip code": "",
                "Address": "Auraria Campus, Tivoli Quad 1000 Larimer St, Denver",
                "Cost": "Free",
                "Description": "A proper German-style holiday market celebrating its 25th anniversary. The market has moved this year to dodge construction in Civic Center Park, and will be located on Tivoli Quad at the Auraria Campus, beside the Tivoli Union building built by German brewer Moritz Sigi in 1870.",
                "Website": "https://www.christkindlmarketdenver.com/"
            },
            {
                "Name": "Howliday Market",
                "Latitude": 39.5865009,
                "lon": -105.0237441,
                "Icon": "snowflake",
                "Color": "#d43e1f",
                "Date": "Dec. 12-23",
                "Zip code": "",
                "Address": "Aspen Grove Mall, 7301 S. Santa Fe Dr., Littleton",
                "Cost": "Free",
                "Description": "A holiday market for all the good boys and girls, with more than 20 pet-focused vendors, a dog sweater contest and Santa Paws Photos for a Cause, a ticketed add-on with proceeds going to two local animal rescues.",
                "Website": "https://aspengrovecenter.com/event/howliday-dog-market/"
            }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            updateStats();
            initializeMap();
            initializeTable();
            initializeFilters();
            populateMarketSelector();
        }

        function updateStats() {
            document.getElementById('total-markets').textContent = marketData.length;
            
            const freeMarkets = marketData.filter(market => market.Cost.toLowerCase().includes('free')).length;
            document.getElementById('free-markets').textContent = freeMarkets;
            
            const denverMarkets = marketData.filter(market => 
                market.Address.toLowerCase().includes('denver') || 
                market.Address.toLowerCase().includes('littleton')
            ).length;
            document.getElementById('denver-markets').textContent = denverMarkets;
        }

        function initializeMap() {
            const width = document.getElementById('map').clientWidth;
            const height = 500;
            const margin = { top: 20, right: 20, bottom: 30, left: 40 };

            // Create SVG
            const svg = d3.select("#map")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            // Colorado outline
            const coloradoOutline = [
                {lon: -109.060253, lat: 36.992426},
                {lon: -102.041524, lat: 36.992426},
                {lon: -102.041524, lat: 40.979897},
                {lon: -109.060253, lat: 40.979897},
                {lon: -109.060253, lat: 36.992426}
            ];

            // Set up scales
            const xScale = d3.scaleLinear()
                .domain(d3.extent(marketData, d => d.lon))
                .range([margin.left, width - margin.right]);

            const yScale = d3.scaleLinear()
                .domain(d3.extent(marketData, d => d.Latitude))
                .range([height - margin.bottom, margin.top]);

            // Draw Colorado outline
            const lineGenerator = d3.line()
                .x(d => xScale(d.lon))
                .y(d => yScale(d.lat));

            svg.append("path")
                .datum(coloradoOutline)
                .attr("d", lineGenerator)
                .attr("fill", "none")
                .attr("stroke", "#ccc")
                .attr("stroke-width", 1)
                .attr("stroke-dasharray", "5,5");

            // Create tooltip
            const tooltip = d3.select("body")
                .append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // Draw market points
            const points = svg.selectAll(".market-point")
                .data(marketData)
                .enter()
                .append("circle")
                .attr("class", "market-point")
                .attr("cx", d => xScale(d.lon))
                .attr("cy", d => yScale(d.Latitude))
                .attr("r", 8)
                .attr("fill", d => d.Color)
                .attr("stroke", "#fff")
                .attr("stroke-width", 2)
                .style("cursor", "pointer")
                .on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`
                        <strong>${d.Name}</strong><br/>
                        <em>${d.Date}</em><br/>
                        ${d.Address}
                    `)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                })
                .on("click", function(event, d) {
                    highlightMarket(d);
                });

            // Add city labels for context
            const cities = [
                { name: "Denver", lat: 39.7392, lon: -104.9903 },
                { name: "Boulder", lat: 40.0150, lon: -105.2705 },
                { name: "Colorado Springs", lat: 38.8339, lon: -104.8214 }
            ];

            svg.selectAll(".city-label")
                .data(cities)
                .enter()
                .append("text")
                .attr("class", "city-label")
                .attr("x", d => xScale(d.lon))
                .attr("y", d => yScale(d.lat))
                .attr("text-anchor", "middle")
                .attr("dy", -10)
                .style("font-size", "12px")
                .style("fill", "#666")
                .text(d => d.name);
        }

        function initializeTable() {
            const tableBody = d3.select("#market-table tbody");
            
            const rows = tableBody.selectAll("tr")
                .data(marketData)
                .enter()
                .append("tr")
                .on("click", function(event, d) {
                    highlightMarket(d);
                });

            rows.append("td").html(d => `<strong>${d.Name}</strong>`);
            rows.append("td").text(d => d.Date);
            rows.append("td").text(d => {
                if (d.Address.includes("Denver")) return "Denver";
                if (d.Address.includes("Littleton")) return "Littleton";
                return "Colorado";
            });
            rows.append("td").text(d => d.Cost);
        }

        function initializeFilters() {
            // Date filter
            document.getElementById('date-filter').addEventListener('change', applyFilters);
            
            // Cost filter
            document.getElementById('cost-filter').addEventListener('change', applyFilters);
            
            // Search filter
            document.getElementById('search').addEventListener('input', applyFilters);
            
            // Reset filters
            document.getElementById('reset-filters').addEventListener('click', function() {
                document.getElementById('date-filter').value = 'all';
                document.getElementById('cost-filter').value = 'all';
                document.getElementById('search').value = '';
                document.getElementById('market-selector').value = '';
                applyFilters();
            });
            
            // Market selector
            document.getElementById('market-selector').addEventListener('change', function() {
                const selectedMarketName = this.value;
                if (selectedMarketName) {
                    const market = marketData.find(m => m.Name === selectedMarketName);
                    if (market) {
                        highlightMarket(market);
                    }
                }
            });
        }

        function populateMarketSelector() {
            const selector = document.getElementById('market-selector');
            selector.innerHTML = '<option value="">Select a market...</option>';
            
            marketData.forEach(market => {
                const option = document.createElement('option');
                option.value = market.Name;
                option.textContent = market.Name;
                selector.appendChild(option);
            });
        }

        function applyFilters() {
            const dateFilter = document.getElementById('date-filter').value;
            const costFilter = document.getElementById('cost-filter').value;
            const searchTerm = document.getElementById('search').value.toLowerCase();

            const filteredData = marketData.filter(market => {
                // Date filter
                if (dateFilter === 'nov' && !market.Date.includes('Nov')) return false;
                if (dateFilter === 'dec' && !market.Date.includes('Dec')) return false;
                
                // Cost filter
                if (costFilter === 'free' && !market.Cost.includes('Free')) return false;
                
                // Search filter
                if (searchTerm && 
                    !market.Name.toLowerCase().includes(searchTerm) && 
                    !market.Address.toLowerCase().includes(searchTerm)) {
                    return false;
                }
                
                return true;
            });

            // Update table
            const rows = d3.select("#market-table tbody").selectAll("tr")
                .data(filteredData, d => d.Name);

            rows.exit().remove();

            const newRows = rows.enter()
                .append("tr")
                .on("click", function(event, d) {
                    highlightMarket(d);
                });

            newRows.append("td").html(d => `<strong>${d.Name}</strong>`);
            newRows.append("td").text(d => d.Date);
            newRows.append("td").text(d => {
                if (d.Address.includes("Denver")) return "Denver";
                if (d.Address.includes("Littleton")) return "Littleton";
                return "Colorado";
            });
            newRows.append("td").text(d => d.Cost);

            // Update map points visibility
            d3.selectAll(".market-point")
                .style("opacity", d => filteredData.includes(d) ? 1 : 0.2);
        }

        function highlightMarket(market) {
            // Reset all highlights
            d3.selectAll(".market-point").attr("r", 8);
            d3.selectAll("#market-table tr").classed("selected", false);
            
            // Highlight selected market on map
            d3.selectAll(".market-point")
                .filter(d => d.Name === market.Name)
                .attr("r", 12);
            
            // Highlight selected market in table
            d3.selectAll("#market-table tr")
                .filter(d => d.Name === market.Name)
                .classed("selected", true);
            
            // Update market selector
            document.getElementById('market-selector').value = market.Name;
            
            // Show details
            showMarketDetails(market);
            
            // Scroll to details
            document.getElementById('market-details').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        function showMarketDetails(market) {
            const detailsContainer = document.getElementById('market-details');
            
            detailsContainer.innerHTML = `
                <h3>${market.Name}</h3>
                <div class="detail-item">
                    <span class="detail-label">Dates:</span> ${market.Date}
                </div>
                <div class="detail-item">
                    <span class="detail-label">Location:</span> ${market.Address}
                </div>
                <div class="detail-item">
                    <span class="detail-label">Cost:</span> ${market.Cost}
                </div>
                <div class="detail-item">
                    <span class="detail-label">Description:</span> ${market.Description}
                </div>
                <div class="detail-item">
                    <span class="detail-label">Website:</span> 
                    <a href="${market.Website}" target="_blank">${market.Website}</a>
                </div>
            `;
            
            detailsContainer.classList.add('active');
        }

        // Handle window resize
        window.addEventListener('resize', function() {
            // Simple resize handling - in a production app you might want to 
            // fully recreate the map or use more sophisticated responsive techniques
            d3.select("#map svg").attr("width", document.getElementById('map').clientWidth);
        });
    </script>
</body>
</html>